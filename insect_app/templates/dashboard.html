{% extends 'base.html' %}

{% block content-f %}
<div class="mt-4">
    <h1 class="mb-4">{{ titulo }}</h1>
    
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <i class="fas fa-thermometer-half"></i> Gráfico de Temperaturas
                </div>
                <div class="card-body">
                    <canvas id="temperaturaChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <i class="fas fa-tint"></i> Gráfico de Humedades
                </div>
                <div class="card-body">
                    <canvas id="humedadChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{{ labels_temp|json_script:"labels-temp-data" }}
{{ data_temp|json_script:"data-temp-values" }}
{{ labels_hum|json_script:"labels-hum-data" }}
{{ data_hum|json_script:"data-hum-values" }}


<script>
    document.addEventListener('DOMContentLoaded', function () {
    
        // --- GRÁFICO DE TEMPERATURA ---
        const ctxTemp = document.getElementById('temperaturaChart');

        if (ctxTemp) {
            const labelsTemp = JSON.parse(document.getElementById('labels-temp-data').textContent);
            const dataTempValues = JSON.parse(document.getElementById('data-temp-values').textContent);

            new Chart(ctxTemp, {
                type: 'line',
                data: {
                    labels: labelsTemp,
                    datasets: [{
                        label: 'Temperatura (°C)',
                        data: dataTempValues,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        },
                        // **CORRECCIÓN CLAVE: Aumentar la rotación a 90 grados**
                        x: {
                            ticks: {
                                maxRotation: 90, 
                                minRotation: 90,
                                autoSkip: false,
                                // También podemos alinear el texto para que se vea mejor
                                align: 'end' 
                            }
                        }
                    }
                }
            });
        }

        // --- GRÁFICO DE HUMEDAD ---
        const ctxHum = document.getElementById('humedadChart');

        if (ctxHum) {
            const labelsHum = JSON.parse(document.getElementById('labels-hum-data').textContent);
            const dataHumValues = JSON.parse(document.getElementById('data-hum-values').textContent);
            
            new Chart(ctxHum, {
                type: 'line',
                data: {
                    labels: labelsHum,
                    datasets: [{
                        label: 'Humedad (%)',
                        data: dataHumValues,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false
                        },
                        // **CORRECCIÓN CLAVE: Aumentar la rotación a 90 grados**
                        x: {
                            ticks: {
                                maxRotation: 90, 
                                minRotation: 90,
                                autoSkip: false,
                                align: 'end'
                            }
                        }
                    }
                }
            });
        }
    });
</script>

{% endblock %}